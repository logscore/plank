FROM node:22

# Install git for lefthook and curl for healthcheck
RUN apt-get update && apt-get install -y curl ca-certificates ffmpeg

WORKDIR /app

COPY package*.json ./

# Install all deps (including dev)
RUN npm ci

COPY . .

RUN chmod +x /app/docker/entrypoint.sh \
  /app/docker/configure-prowlarr.sh

EXPOSE 3300 6881

ENTRYPOINT ["/app/docker/entrypoint.sh"]
