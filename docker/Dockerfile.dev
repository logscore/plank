FROM node:22-alpine

# Install git for lefthook and curl for healthcheck
RUN apk add --no-cache git curl

WORKDIR /app

COPY package*.json ./

# Install all deps (including dev)
RUN npm ci

COPY . .

# Make scripts executable
RUN chmod +x /app/docker/entrypoint.sh /app/docker/configure-prowlarr.sh

EXPOSE 3300 6881

ENTRYPOINT ["/app/docker/entrypoint.sh"]
